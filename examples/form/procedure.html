<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <script src="../../lib/Alien/GvaScript/lib/prototype.js"></script>
    <script src="../../lib/Alien/GvaScript/lib/GvaScript.js"></script>

<script>

function msg(msg) {
  $('msgs').innerHTML += "<br>" + msg;
}


var tree = {
  proc:{
    motif:[
      {C_MOTIF:"C1"}, 
      {C_MOTIF:"C2", TXT_MOTIF: true},
      {C_MOTIF:"C3", TXT_MOTIF:123},
      {C_MOTIF:"C4", TXT_MOTIF:456},
      {C_MOTIF:"C5"}
      ],
    partie:[
      {C_ROLE_PARTIE:"DEM", NOM_PRE_ROLE:"TOTO 1", 
       avoc: [{CLE_AVOC: 1234}, {CLE_AVOC: 5678}]},
      {C_ROLE_PARTIE:"DEF", NOM_PRE_ROLE:"TOTO 2", 
       avoc: [{CLE_AVOC: 1111}, {CLE_AVOC: 2222}, {CLE_AVOC: 3333}]},
      {C_ROLE_PARTIE:"TEM", NOM_PRE_ROLE:"TOTO 3"}
      ]
  }
};


function setup() {
  var form = $('form');

  GvaScript.Form.init(form, tree);
}

window.onload = setup;

function motif_on_add(event) {
  event.target.cells[3].innerHTML += " // " + event.target.id;
}

function save_form(form) {
  var tree = GvaScript.Form.to_tree(form);
  var json = Object.toJSON(tree);

  var fso = new ActiveXObject("Scripting.FileSystemObject");
  var file = fso.CreateTextFile(path, true);
  file.Write(txt);
  file.Close();

}


</script>

  </head>

  <body>
    <h1>Tst form with repeat</h1>




<button onclick="save_form($('form'))">Save JSON</button>


<form id="form" method="post">



<h2>Motifs</h2>


<table>
  <tr> 
   <td>Ix</td>
   <td>Code</td>
   <td>Texte</td>
  </tr>
  <tr repeat="motif" repeat-start="3" repeat-prefix="proc"
       onAdd="motif_on_add(event)"
       onRemove="alert(event.target.id + ' is removed')">
    <td>#{motif.count}</td>
    <td><input name="#{motif.path}.C_MOTIF" size="4" autofocus></td>
    <td><input name="#{motif.path}.TXT_MOTIF" size="20"></td>
    <td><button onclick="GvaScript.Form.remove('#{motif.path}'); return false">
           Del
         </button></td>
  </tr>
</table>
<button onclick="GvaScript.Form.add('proc.motif'); return false">Nouveau motif</button>
<button type=button onclick="GvaScript.Form.add('proc.motif')">Nouveau motif</button>
<a href="javascript:GvaScript.Form.add('proc.motif')">Nouveau motif</a>

<div repeat="partie" repeat-prefix="proc"
       onAdd="event.target.style.border = '1px solid red'" >
<h2>Partie #{partie.count}</h2>

<table>
  <tr><td>Rôle</td>
     <td><input name="#{partie.path}.C_ROLE_PARTIE" autofocus
                  size="4"></td>
  </tr>

  <tr><td>Nom/pré</td>
     <td><input name="#{partie.path}.NOM_PRE_ROLE"
                  size="20"></td>
  </tr>

  <tr><td>Justiciable</td>
     <td><input name="#{partie.path}.CLE_PARTIE"
                  size="10"></td>
  </tr>

  <tr><td>Avocats</td>
     <td><table>
          <tr repeat="avoc" repeat-start="0">
            <td>#{avoc.count}</td>
            <td><input name="#{avoc.path}.CLE_AVOC" autofocus></td>
          </tr>
        </table>
         <button onclick="GvaScript.Form.add('#{partie.path}.avoc'); return false">
           Nouvel avocat
         </button>

     </td>
  </tr>
</table>

<button onclick="GvaScript.Form.remove('#{partie.path}'); return false">
           Del
</button>


</div><!-- fin div partie -->

<button onclick="GvaScript.Form.add('proc.partie'); return false">
  Nouvelle partie
</button>



<br>
<input type="submit" onclick="show_tree(this.form); return false">

</form>



<div id="msgs"></div>



</body>
</html>




