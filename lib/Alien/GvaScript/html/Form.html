<html>
<head>
  <link href="../lib/GvaScript.css" rel="stylesheet" type="text/css">
  <script src="../lib/prototype.js"></script>
  <script src="../lib/GvaScript.js"></script>
  <link href="GvaScript_doc.css" rel="stylesheet" type="text/css">
  <script>
    var treeNavigator;
    function setup() {  
      new GvaScript.TreeNavigator('TN_tree');
    }
    window.onload = setup;
    function jumpto_href(event) {
      var label = event.controller.label(event.target);
      if (label && label.tagName == "A") {
        label.focus();
        return Event.stopNone;
      }
    }
  </script>
</head>
<body>
<div id='TN_tree'>
  <div class="TN_node">
   <h1 class="TN_label">GvaScript.Form</h1>
   <div class="TN_content">
     <p><em>Helper functions for forms
</em></p>
     <div class="TN_node"  onPing="jumpto_href">
       <h3 class="TN_label">Table of contents</h3>
       <div class="TN_content">
         <div class="TN_leaf">
  <a class="TN_label" href="#NAME">NAME</a>
  <div class="TN_content"></div>
</div>
<div class="TN_leaf">
  <a class="TN_label" href="#SYNOPSIS">SYNOPSIS</a>
  <div class="TN_content"></div>
</div>
<div class="TN_leaf">
  <a class="TN_label" href="#DESCRIPTION">DESCRIPTION</a>
  <div class="TN_content"></div>
</div>
<div class="TN_node">
  <a class="TN_label" href="#HTML">HTML</a>
  <div class="TN_content"><div class="TN_leaf">
  <a class="TN_label" href="#Markup_of_repeat_elements">Markup of repeat elements</a>
  <div class="TN_content"></div>
</div>
<div class="TN_leaf">
  <a class="TN_label" href="#Autofocus">Autofocus</a>
  <div class="TN_content"></div>
</div>
</div>
</div>
<div class="TN_node">
  <a class="TN_label" href="#METHODS">METHODS</a>
  <div class="TN_content"><div class="TN_leaf">
  <a class="TN_label" href="#init">init</a>
  <div class="TN_content"></div>
</div>
<div class="TN_leaf">
  <a class="TN_label" href="#to_hash">to_hash</a>
  <div class="TN_content"></div>
</div>
<div class="TN_leaf">
  <a class="TN_label" href="#to_tree">to_tree</a>
  <div class="TN_content"></div>
</div>
<div class="TN_leaf">
  <a class="TN_label" href="#fill_from_tree">fill_from_tree</a>
  <div class="TN_content"></div>
</div>
<div class="TN_leaf">
  <a class="TN_label" href="#expand_hash">expand_hash</a>
  <div class="TN_content"></div>
</div>
<div class="TN_leaf">
  <a class="TN_label" href="#add">add</a>
  <div class="TN_content"></div>
</div>
<div class="TN_leaf">
  <a class="TN_label" href="#remove">remove</a>
  <div class="TN_content"></div>
</div>
<div class="TN_leaf">
  <a class="TN_label" href="#autofocus">autofocus</a>
  <div class="TN_content"></div>
</div>
</div>
</div>

       </div>
     </div>
     <hr/>
   </div>
  </div>
  <div class="TN_node" id="NAME">
    <h2 class="TN_label">NAME</h2>
    <div class="TN_content">
      <p>GvaScript.Form - Helper functions for forms</p>

    </div>
  </div>
  <div class="TN_node" id="SYNOPSIS">
    <h2 class="TN_label">SYNOPSIS</h2>
    <div class="TN_content">
      <pre>  &lt;form id="my_form"&gt;
    &lt;div repeat="foo"&gt;
      &lt;h2&gt;Foo #{foo.count}&lt;/h2&gt;
      This is the repeated foo section
      &lt;table&gt;
        &lt;tr repeat="bar"&gt;
          &lt;td&gt;Item #{bar.count}&lt;/td&gt;
          &lt;td&gt;&lt;input name="#{bar.path}.buz"&gt;&lt;/td&gt;
          &lt;td&gt;&lt;button onclick="GvaScript.Form.remove('#{bar.path}')"&gt;
                Remove this row
              &lt;/button&gt;&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/table&gt;
       &lt;button onclick="GvaScript.Form.add('#{foo.path}.bar')"&gt;
          Add a bar
       &lt;/button&gt;
    &lt;/div&gt;  
    &lt;button onclick="GvaScript.Form.add('foo')"&gt;Add a foo&lt;/button&gt;
  &lt;/form&gt;</pre>

<pre>  &lt;script&gt;
    GvaScript.Form.init(document.body);
  &lt;/script</pre>


    </div>
  </div>
  <div class="TN_node" id="DESCRIPTION">
    <h2 class="TN_label">DESCRIPTION</h2>
    <div class="TN_content">
      <p>This module of <i>Alien::GvaScript</i> manages forms with
hierarchical fields and dynamically repeated sections.
It works in close collaboration with  <i>Alien::GvaScript::Repeat</i>.</p>
<p>The design is partially inspired by the <code>Web Forms 2.0</code> proposal
(<a href="http://www.whatwg.org/specs/web-forms/current-work/">http://www.whatwg.org/specs/web-forms/current-work/</a>), but is 
not an attempt to implement the proposed specification: there are
some differences both in syntax and in semantics.</p>

    </div>
  </div>
  <div class="TN_node" id="HTML">
    <h2 class="TN_label">HTML</h2>
    <div class="TN_content">
        <div class="TN_node" id="Markup_of_repeat_elements">
    <h3 class="TN_label">Markup of repeat elements</h3>
    <div class="TN_content">
      <p>Repeat elements may occur outside of forms and therefore 
are described in a separate document; 
see <i>Alien::GvaScript::Repeat</i>.</p>

    </div>
  </div>
  <div class="TN_node" id="Autofocus">
    <h3 class="TN_label">Autofocus</h3>
    <div class="TN_content">
      <p>The <a href="#init">/init</a> method inspects all form elements for an
<code>autofocus</code> attribute; the first element that possesses
this attribute automatically receives focus.</p>
<p>Similarly, when a repetition block is added into 
the form through the <a href="#add">/add</a> method, the first
element within that repetition block that possesses
an <code>autofocus</code> attribute automatically receives focus.</p>

    </div>
  </div>

    </div>
  </div>
  <div class="TN_node" id="METHODS">
    <h2 class="TN_label">METHODS</h2>
    <div class="TN_content">
        <div class="TN_node" id="init">
    <h3 class="TN_label">init</h3>
    <div class="TN_content">
      <pre>   GvaScript.Form.init(form, initial_tree)</pre>

<p><code>form</code> is the id of a form (or directly the DOM element).  Optional
<code>initial_tree</code> is a javascript nested datastructure containing
initial values for fields, that will be passed to the 
<a href="#fill_from_tree">/fill_from_tree</a> method.</p>

    </div>
  </div>
  <div class="TN_node" id="to_hash">
    <h3 class="TN_label">to_hash</h3>
    <div class="TN_content">
      <pre>  var flat_hash = GvaScript.Form.to_hash(form);</pre>

<p>Inspects the contents of all fields in <code>form</code> and 
returns a flat hash of pairs (key-value).</p>

    </div>
  </div>
  <div class="TN_node" id="to_tree">
    <h3 class="TN_label">to_tree</h3>
    <div class="TN_content">
      <pre>  var tree = GvaScript.Form.to_tree(form);</pre>

<p>Inspects the contents of all fields in <code>form</code> and 
returns a data tree, were dotted names in form names
are expanded into sub-arrays or sub-hashes. So for example 
if the form looks like</p>
<pre>  &lt;input name="father.firstname"&gt; &lt;input name="father.lastname"&gt;&lt;br&gt;
  &lt;input name="mother.firstname"&gt; &lt;input name="mother.lastname"&gt;&lt;br&gt;
  &lt;div repeat="child" repeat-start="1"&gt;
    &lt;input name="#{child.path}.firstname"&gt;&lt;br&gt;
  &lt;/div&gt;</pre>

<p>and if that form has been expanded with 3 repetition blocks
for children, the resulting tree would be</p>
<pre>  { "father" : {"firstname" : ..., "lastname": ...},
    "mother" : {"firstname" : ..., "lastname": ...},
    "child"  : [ {"firstname": ...},
                 {"firstname": ...},
                 {"firstname": ...} ] }</pre>


    </div>
  </div>
  <div class="TN_node" id="fill_from_tree">
    <h3 class="TN_label">fill_from_tree</h3>
    <div class="TN_content">
      <pre>  GvaScript.Form.fill_from_tree(form, field_prefix, tree);</pre>

<p>Fills the form from values found in <code>tree</code> (this is the 
reverse of the <a href="#to_tree">/to_tree</a> operation).
Optional <code>field_prefix</code> is prepended to key names in <code>tree</code> for
finding the corresponding form fields.</p>
<p>The method walks through nested subtrees in <code>tree</code>: the sequence
of keys leading to a leaf is concatenated into a flat string, with dot 
separators, and if the form has a corresponding input element,
the value of that element is set to the value of the leaf.
Furthermore, if the initial tree contains repeated data sets
(array subtrees), and if the form contains repeat elements
with the same path, then new repetition blocks are 
dynamically created to match the number of items in the array:
so if the form above is filled with the following tree</p>
<pre>  { "child"  : [ {"firstname": "Abel"},
                 {"firstname": "Bob"},
                 {"firstname": "Cod"},
                 {"firstname": "Dave"}, ] }</pre>

<p>then four repetition blocks will automatically created in the form.</p>

    </div>
  </div>
  <div class="TN_node" id="expand_hash">
    <h3 class="TN_label">expand_hash</h3>
    <div class="TN_content">
      <pre>  var tree = GvaScript.Form.expand_hash(flat_hash);</pre>

<p>Transforms a flat structure of key-value pairs into a nested tree
structure, by splitting keys on dots.
The idea and algorithm come from <i>CGI::Expand/expand_hash</i>.</p>

    </div>
  </div>
  <div class="TN_node" id="add">
    <h3 class="TN_label">add</h3>
    <div class="TN_content">
      <pre>  GvaScript.Form.add(repeat_name, count);</pre>

<p>Creates one or several new repetition blocks.  The parameter <code>count</code>
is optional and defaults to 1.  Focus is automatically given to the
first input element in the last repetition block that has an
<code>autofocus</code> attribute (if any).</p>
<p>See <i>Alien::GvaScript::Repeat/add</i> for more explanations on
the <code>add</code> operation.</p>

    </div>
  </div>
  <div class="TN_node" id="remove">
    <h3 class="TN_label">remove</h3>
    <div class="TN_content">
      <pre>  GvaScript.Form.remove(repeat_block);</pre>

<p>Removes a repetition block from the DOM. The argument is either
a DOM element or a string containing the element id.</p>
<p>All repetition blocks above the removed block are renumbered,
leaving no hole in the index sequence. To do so, these
blocks are also removed from the DOM, and then added
again through the <a href="#add">/add</a> method. This operation is implemented
by <i>Alien::GvaScript::Repeat/remove</i>.</p>
<p>The recreated blocks are then re-populated with their
previous input values.</p>

    </div>
  </div>
  <div class="TN_node" id="autofocus">
    <h3 class="TN_label">autofocus</h3>
    <div class="TN_content">
      <pre>  GvaScript.Form.autofocus(element);</pre>

<p>Inspects DOM children of  <code>element</code>, and gives focus to the 
first child that has an <code>autofocus</code> attribute.</p>

    </div>
  </div>

    </div>
  </div>

</div>
</body>
</html>
